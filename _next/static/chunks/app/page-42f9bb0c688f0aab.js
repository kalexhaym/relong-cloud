(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8755:(e,t,n)=>{Promise.resolve().then(n.bind(n,5236)),Promise.resolve().then(n.bind(n,2587)),Promise.resolve().then(n.bind(n,9532)),Promise.resolve().then(n.bind(n,4929)),Promise.resolve().then(n.bind(n,4297)),Promise.resolve().then(n.bind(n,5916)),Promise.resolve().then(n.bind(n,1201)),Promise.resolve().then(n.bind(n,9479)),Promise.resolve().then(n.bind(n,7876)),Promise.resolve().then(n.bind(n,4825)),Promise.resolve().then(n.bind(n,3071)),Promise.resolve().then(n.bind(n,8098)),Promise.resolve().then(n.bind(n,9971)),Promise.resolve().then(n.bind(n,8260)),Promise.resolve().then(n.bind(n,5455)),Promise.resolve().then(n.bind(n,4787)),Promise.resolve().then(n.bind(n,168)),Promise.resolve().then(n.bind(n,8084)),Promise.resolve().then(n.bind(n,9294)),Promise.resolve().then(n.bind(n,93)),Promise.resolve().then(n.bind(n,5955)),Promise.resolve().then(n.bind(n,7020)),Promise.resolve().then(n.bind(n,4284)),Promise.resolve().then(n.bind(n,2343)),Promise.resolve().then(n.bind(n,9931)),Promise.resolve().then(n.bind(n,1558)),Promise.resolve().then(n.bind(n,9376)),Promise.resolve().then(n.bind(n,5297)),Promise.resolve().then(n.bind(n,5730)),Promise.resolve().then(n.bind(n,8560)),Promise.resolve().then(n.bind(n,377)),Promise.resolve().then(n.bind(n,57)),Promise.resolve().then(n.bind(n,3851)),Promise.resolve().then(n.bind(n,5475)),Promise.resolve().then(n.bind(n,5635)),Promise.resolve().then(n.bind(n,7503)),Promise.resolve().then(n.bind(n,258)),Promise.resolve().then(n.bind(n,8209)),Promise.resolve().then(n.bind(n,6418)),Promise.resolve().then(n.bind(n,9573)),Promise.resolve().then(n.bind(n,7467)),Promise.resolve().then(n.bind(n,8898)),Promise.resolve().then(n.bind(n,3991)),Promise.resolve().then(n.bind(n,8043)),Promise.resolve().then(n.bind(n,8915)),Promise.resolve().then(n.bind(n,1033)),Promise.resolve().then(n.bind(n,8881)),Promise.resolve().then(n.bind(n,2523)),Promise.resolve().then(n.bind(n,3401)),Promise.resolve().then(n.bind(n,2765)),Promise.resolve().then(n.bind(n,8027)),Promise.resolve().then(n.bind(n,2303)),Promise.resolve().then(n.bind(n,3535)),Promise.resolve().then(n.bind(n,966)),Promise.resolve().then(n.bind(n,8073)),Promise.resolve().then(n.bind(n,4088)),Promise.resolve().then(n.bind(n,1001)),Promise.resolve().then(n.bind(n,8499)),Promise.resolve().then(n.bind(n,6615)),Promise.resolve().then(n.bind(n,2480)),Promise.resolve().then(n.bind(n,9277)),Promise.resolve().then(n.bind(n,4969))},5236:(e,t,n)=>{"use strict";n.d(t,{default:()=>I});var o=n(5155),i=n(2115);let s=e=>{let{online:t}=e;return(0,o.jsx)("div",{className:"online",children:t})};var r=n(8319),l=n(8422),a=n(3858),c=n(4282),d=n(9392),u=n(729);let h=e=>{let{tool:t,palette:n,color:s,range:h,onColorChange:m,onRangeChange:f,onView:v,onEyeDropper:g,onClear:p}=e,[b,x]=(0,i.useState)(!1);return(0,o.jsxs)("div",{children:[(0,o.jsxs)(r.aF,{className:"modal",dismissible:!0,show:b,size:"md",onClose:()=>x(!1),popup:!0,children:[(0,o.jsx)(r.aF.Header,{}),(0,o.jsx)(r.aF.Body,{children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)(l.f9d,{className:"mx-auto mb-4 h-14 w-14 text-white-400 dark:text-white-200"}),(0,o.jsx)("h3",{className:"mb-5 text-lg font-normal text-white-500 dark:text-white-400",children:"Are you sure you want to clear canvas?"}),(0,o.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,o.jsx)(r.$n,{color:"failure",onClick:()=>{x(!1),p()},children:"Yes, I'm sure"}),(0,o.jsx)(r.$n,{color:"gray",onClick:()=>x(!1),children:"No, cancel"})]})]})})]}),(0,o.jsxs)("div",{className:"controls",children:[(0,o.jsxs)("div",{className:"controls-row",children:[(0,o.jsx)("input",{type:"color",value:s,onChange:e=>{m(e.target.value)},className:"mb-4"}),(0,o.jsx)("input",{type:"range",value:h,onChange:e=>{f(parseInt(e.target.value))},min:"1",max:"50"}),(0,o.jsx)("button",{onClick:v,children:(0,o.jsx)(a.A,{className:"size-6"})}),(0,o.jsx)("button",{onClick:g,children:(0,o.jsx)(o.Fragment,{children:"pencil"===t?(0,o.jsx)(c.A,{className:"size-6"}):(0,o.jsx)(d.A,{className:"size-6"})})}),(0,o.jsx)("button",{onClick:()=>x(!0),children:(0,o.jsx)(u.A,{className:"size-6"})})]}),(0,o.jsx)(o.Fragment,{children:n.length>0&&(0,o.jsx)("div",{className:"controls-row color-palette",children:n.map((e,t)=>(0,o.jsx)("button",{style:{backgroundColor:e},onClick:()=>m(e)},"color-".concat(t)))})})]})]})};var m=n(5565),f=n(1886),v=n(7387),g=n(6046),p=n(5930),b=n(9230),x=n(3922),j=n(9903),y=n(9904);let P=0===(0,y.Dk)().length?(0,y.Wp)({apiKey:"",authDomain:"",projectId:"",storageBucket:"",messagingSenderId:"",appId:"",measurementId:""}):(0,y.Sx)(),w=async()=>await (0,j.TT)()?(0,j.dG)(P):null,S=async()=>{try{let e=await w();if(e)return await (0,j.gf)(e,{vapidKey:""});return null}catch(e){return console.error("An error occurred while fetching the token:",e),null}};var N=n(814);async function k(){return"Notification"in window?"granted"===Notification.permission||"denied"!==Notification.permission&&"granted"===await Notification.requestPermission()?await S():(console.log("Notification permission not granted."),null):(console.info("This browser does not support desktop notification"),null)}let C=()=>{let e=(0,g.useRouter)(),[t,n]=(0,i.useState)(null),[o,s]=(0,i.useState)(null),r=(0,i.useRef)(0),l=(0,i.useRef)(!1),a=async()=>{if(l.current)return;l.current=!0;let e=await k();if("denied"===Notification.permission){n("denied"),console.info("%cPush Notifications issue - permission denied","color: green; background: #c7c7c7; padding: 8px; font-size: 20px"),l.current=!1;return}if(!e){if(r.current>=3){alert("Unable to load token, refresh the browser"),console.info("%cPush Notifications issue - unable to load token after 3 retries","color: green; background: #c7c7c7; padding: 8px; font-size: 20px"),l.current=!1;return}r.current+=1,console.error("An error occurred while retrieving token. Retrying..."),l.current=!1,await a();return}n(Notification.permission),s(e),l.current=!1};return(0,i.useEffect)(()=>{"Notification"in window&&a()},[]),(0,i.useEffect)(()=>{let t=null;return(async()=>{if(!o)return;let t=await w();if(t)return(0,j.xD)(t,t=>{var n,o,i,s,r,l,a,c;if("granted"!==Notification.permission)return;let d=(null===(n=t.fcmOptions)||void 0===n?void 0:n.link)||(null===(o=t.data)||void 0===o?void 0:o.link);d?N.oR.info("".concat(null===(r=t.notification)||void 0===r?void 0:r.title,": ").concat(null===(l=t.notification)||void 0===l?void 0:l.body),{position:"bottom-center",action:{label:"Visit",onClick:()=>{var n,o;let i=(null===(n=t.fcmOptions)||void 0===n?void 0:n.link)||(null===(o=t.data)||void 0===o?void 0:o.link);i&&e.push(i)}}}):N.oR.info("".concat(null===(a=t.notification)||void 0===a?void 0:a.title,": ").concat(null===(c=t.notification)||void 0===c?void 0:c.body),{position:"bottom-center"}),new Notification((null===(i=t.notification)||void 0===i?void 0:i.title)||"New message",{body:(null===(s=t.notification)||void 0===s?void 0:s.body)||"This is a new message",data:d?{url:d}:void 0}).onclick=t=>{var n,o;t.preventDefault();let i=null===(o=t.target)||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.url;i&&e.push(i)}})})().then(e=>{e&&(t=e)}),()=>null==t?void 0:t()},[o,e,N.oR]),{token:o,notificationPermissionStatus:t}},T=e=>{let{topic:t}=e,{token:n,notificationPermissionStatus:s}=C(),[l,a]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=localStorage.getItem("notifications");h(e?e.split(","):[])},[]);let m=async()=>{a(!0);let e=await fetch("/send-notification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:t,token:n,title:"The Bell rang!",message:"Hurry up and check what happened.",link:"https://relong.cloud/?token=".concat(t),subscribed:u.includes(t)})});await e.json().then(()=>{u.push(t),h(u),localStorage.setItem("notifications",u.join(",")),a(!1)}).catch(()=>{N.oR.error("Error? Try again...",{icon:(0,o.jsx)(p.A,{}),position:"bottom-center"}),a(!1)})},f=async()=>{d(!0);let e=await fetch("/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:t,token:n})});await e.json().then(()=>{u.splice(u.indexOf(t),1),h(u),localStorage.setItem("notifications",u.join(",")),d(!1)}).catch(()=>{N.oR.error("Error? Try again...",{icon:(0,o.jsx)(p.A,{}),position:"bottom-center"}),d(!1)})};return(0,o.jsx)(o.Fragment,{children:"granted"===s&&(0,o.jsxs)("div",{children:[(0,o.jsx)(o.Fragment,{children:u.includes(t)&&(0,o.jsx)("button",{className:"unsubscribe",disabled:c,onClick:f,children:(0,o.jsx)(o.Fragment,{children:c?(0,o.jsx)("div",{className:"absolute flex justify-center items-center w-dvw h-dvh",children:(0,o.jsx)(r.y$,{"aria-label":"Loading...",size:"md"})}):(0,o.jsx)(b.A,{className:"size-4"})})})}),(0,o.jsx)("button",{className:"bell",disabled:l,onClick:m,children:(0,o.jsx)(o.Fragment,{children:l?(0,o.jsx)("div",{className:"absolute flex justify-center items-center w-dvw h-dvh",children:(0,o.jsx)(r.y$,{"aria-label":"Loading...",size:"xl"})}):(0,o.jsx)(x.A,{className:"size-6"})})})]})})},I=()=>{let e=(0,i.useRef)(null),t=(0,i.useRef)(null),n=(0,i.useRef)(0),l=(0,i.useRef)(null),[a,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(!0),[p,b]=(0,i.useState)("pencil"),[x,j]=(0,i.useState)([]),[y,P]=(0,i.useState)(!1),[w,S]=(0,i.useState)(!1),[N,k]=(0,i.useState)(0),[C,I]=(0,i.useState)(0),[R,E]=(0,i.useState)(0),[F,M]=(0,i.useState)(0),[z,A]=(0,i.useState)(null),[L,O]=(0,i.useState)("#ffffff"),[D,Y]=(0,i.useState)(10),[X,W]=(0,i.useState)(!1),[$,B]=(0,i.useState)(!1),[J,U]=(0,i.useState)(70),[_]=(0,i.useState)(3e3),[H]=(0,i.useState)(3e3),K=(0,i.useRef)(25),[V]=(0,i.useState)(150),[q]=(0,i.useState)(25),[G,Z]=(0,i.useState)(25),[Q,ee]=(0,i.useState)(0),[et,en]=(0,i.useState)(0),[eo,ei]=(0,i.useState)(!1),[es,er]=(0,i.useState)(null),[el,ea]=(0,i.useState)(!1),[ec,ed]=(0,i.useState)(""),[eu,eh]=(0,i.useState)("default"),em=(0,g.useSearchParams)();(0,i.useEffect)(()=>{let e=em.get("token")||"default";eh(e.replace(/[^a-zA-Z0-9]/g,"")),O(localStorage.getItem("color")||"#"+Math.floor(0xffffff*Math.random()).toString(16).padStart(6,"0"));let t=localStorage.getItem("range");Y(t?parseInt(t):10);let o=new window.Image;return o.onerror=o.onabort=function(){W(!1)},o.onload=function(){W(!0)},o.src="/references/".concat(e,".jpg"),()=>{l.current&&(clearTimeout(l.current),l.current=null,n.current=0),es&&es.close()}},[]),(0,i.useEffect)(()=>{let e=t.current;if(e){let t=e.getContext("2d");t&&(t.lineWidth=D,t.lineCap="round",t.strokeStyle=L,a||(t.rect(0,0,_,H),t.fill()),A(t),a&&(localStorage.setItem("color",L),localStorage.setItem("range",String(D))))}},[a,L,D]),(0,i.useEffect)(()=>{z&&!es&&ef()},[z]);let ef=()=>{{ei(!1);let e=localStorage.getItem("state");e&&eR(e),en(1),j([]),u(!1),c(!0),console.log("WebSocket not configured, app running in no WebSocket mode.")}},ev=e=>{e.preventDefault()},eg=t=>{if("touches"in t&&2===t.touches.length||"button"in t&&2===t.button){P(!1),S(!0);let n=e.current;if(n){let e="touches"in t?ek(t):{x:t.pageX,y:t.pageY};k(e.x-n.offsetLeft),E(n.scrollLeft),I(e.y-n.offsetTop),M(n.scrollTop)}}"touches"in t&&2===t.touches.length&&ee(eT(t))},ep=t=>{if(!w)return;let n=e.current;if(n){let e="touches"in t?ek(t):{x:t.pageX,y:t.pageY};n.scrollLeft=R-(e.x-n.offsetLeft-N)*3,n.scrollTop=F-(e.y-n.offsetTop-C)*3}if("touches"in t){let e=eT(t);Math.abs(Q-e)>5&&(e>Q?eC("up",2):eC("down",2)),ee(e)}},eb=()=>{S(!1)},ex=e=>{switch(p){case"pencil":("touches"in e&&1===e.touches.length||"button"in e&&0===e.button)&&P(!0);break;case"eye-dropper":if(z){let t=eS(e),n=z.getImageData(t.x,t.y,1,1).data;O("#"+("000000"+ej(n[0],n[1],n[2])).slice(-6)),b("pencil")}}},ej=(e,t,n)=>{if(e>255||t>255||n>255)throw"Invalid color component";return(e<<16|t<<8|n).toString(16)},ey=e=>{if(!y||!z||eo&&!es)return;let t=eS(e);es&&es.send(JSON.stringify({type:"draw",x:t.x,y:t.y,color:L,range:D})),eP(t.x,t.y,L,D)},eP=(e,t,n,o)=>{z&&(z.beginPath(),z.arc(e,t,o,0,2*Math.PI,!1),z.fillStyle=n,z.fill())},ew=e=>{y&&z&&(!eo||es)&&(("clientX"in e||"clientY"in e)&&ey(e),es&&es.send(JSON.stringify({type:"save"})),P(!1),eI())},eS=e=>"touches"in e?eN(e):{x:e.nativeEvent.offsetX/(K.current/100),y:e.nativeEvent.offsetY/(K.current/100)},eN=e=>{var n;let o=e.touches[0],i=null===(n=t.current)||void 0===n?void 0:n.getBoundingClientRect();return{x:(o.clientX-((null==i?void 0:i.left)||0))/(K.current/100),y:(o.clientY-((null==i?void 0:i.top)||0))/(K.current/100)}},ek=t=>{var n;let o=t.touches[0],i=null===(n=e.current)||void 0===n?void 0:n.getBoundingClientRect();return{x:o.pageX-((null==i?void 0:i.left)||0),y:o.pageY-((null==i?void 0:i.top)||0)}},eC=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;"up"===e&&K.current<V&&(K.current+=t),"down"===e&&K.current>q&&(K.current-=t),K.current<q&&(K.current=q),K.current>V&&(K.current=V),Z(K.current)},eT=e=>e.touches&&2===e.touches.length?Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY):0,eI=()=>{if(z){let e=t.current;if(e){let t=e.toDataURL();eo&&es?es.send(JSON.stringify({type:"saveState",data:t})):localStorage.setItem("state",t)}}},eR=e=>{if(z){let t=new window.Image;null!=e&&""!=e?t.src=e:(z.reset(),z.rect(0,0,_,H),z.fill()),t.onload=function(){z.reset(),z.drawImage(t,0,0)}}};return(0,o.jsxs)("div",{className:"main-container",children:[(0,o.jsxs)(r.aF,{className:"modal",dismissible:!0,show:el,size:"7xl",onClose:()=>ea(!1),popup:!0,children:[(0,o.jsx)(r.aF.Header,{}),(0,o.jsx)(r.aF.Body,{children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"flex justify-center ",children:(0,o.jsxs)("div",{className:"mb-5 relative",style:{width:"70dvh"},children:[(0,o.jsx)(m.default,{className:"preview",src:ec,width:_,height:H,style:{width:"100%",height:"100%"},alt:"Preview"}),(0,o.jsx)(o.Fragment,{children:X&&(0,o.jsx)(m.default,{className:"reference",onError:()=>{W(!1)},src:"/references/".concat(eu,".jpg"),width:_,height:H,style:{width:"100%",height:"100%",opacity:J/100},alt:"Reference",onWheel:e=>{let t=e.deltaY>0?J-5:J+5;t>100&&(t=100),t<0&&(t=0),U(t)}})})]})}),(0,o.jsx)(o.Fragment,{children:X&&(0,o.jsx)("input",{className:"mb-5",type:"range",value:J,onChange:e=>{U(parseInt(e.target.value))},min:"0",max:"100"})}),(0,o.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,o.jsx)(r.$n,{color:"gray",onClick:()=>{let e=t.current;if(e){let t=document.createElement("a");t.href=e.toDataURL(),t.download="canvas.png",t.click()}},children:(0,o.jsx)(f.A,{className:"size-6"})}),(0,o.jsx)(r.$n,{color:"gray",onClick:()=>ea(!1),children:"Close"})]})]})})]}),(0,o.jsx)(o.Fragment,{children:a&&(0,o.jsxs)("div",{children:[(0,o.jsx)(h,{tool:p,palette:x,color:L,range:D,onColorChange:e=>{O(e)},onRangeChange:e=>{Y(e)},onView:()=>{let e=t.current;e&&(ea(!0),ed(e.toDataURL()))},onEyeDropper:()=>{b("pencil"===p?"eye-dropper":"pencil")},onClear:()=>{eo&&es?(u(!0),es.send(JSON.stringify({type:"clearState"}))):(localStorage.removeItem("state"),z&&(z.reset(),z.rect(0,0,_,H),z.fill()))}}),(0,o.jsx)(o.Fragment,{children:X&&(0,o.jsx)("div",{className:"reference-small",onClick:()=>{B(!$)},children:(0,o.jsx)(o.Fragment,{children:$?(0,o.jsx)(m.default,{onError:()=>{W(!1)},src:"/references/".concat(eu,".jpg"),width:300,height:300,alt:"Reference"}):(0,o.jsx)(v.A,{className:"size-6"})})})}),(0,o.jsx)(o.Fragment,{children:eo&&(0,o.jsxs)("div",{children:[(0,o.jsx)(s,{online:et}),(0,o.jsx)(T,{topic:eu})]})})]})}),(0,o.jsx)(o.Fragment,{children:d&&(0,o.jsx)("div",{className:"absolute flex justify-center items-center w-dvw h-dvh",children:(0,o.jsx)(r.y$,{"aria-label":"Loading...",size:"xl"})})}),(0,o.jsx)("div",{ref:e,onMouseDown:eg,onMouseMove:ep,onMouseUp:eb,onMouseLeave:eb,onTouchStart:eg,onTouchMove:ep,onTouchEnd:eb,onWheel:t=>{if(eC(t.deltaY>0?"down":"up",5),K.current!==V&&K.current!==q){let n=e.current;if(n){let e=K.current/100,o=(t.clientX-n.offsetLeft+n.scrollLeft)/e,i=(t.clientY-n.offsetTop+n.scrollTop)/e,s=o*e-n.clientWidth/2,r=i*e-n.clientHeight/2;n.scrollTo({left:s,top:r})}}},className:"canvas-container",onContextMenu:ev,children:(0,o.jsx)("canvas",{ref:t,onMouseDown:ex,onMouseMove:ey,onMouseUp:ew,onMouseLeave:ew,onTouchStart:ex,onTouchMove:ey,onTouchEnd:ew,width:_,height:H,onContextMenu:ev,style:{width:_,height:H,backgroundColor:"#000000",zoom:"".concat(G,"%")}})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[479,777,446,711,545,814,683,441,517,358],()=>t(8755)),_N_E=e.O()}]);