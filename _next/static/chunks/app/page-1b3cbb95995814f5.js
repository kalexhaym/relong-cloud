(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8755:(e,t,n)=>{Promise.resolve().then(n.bind(n,5236)),Promise.resolve().then(n.bind(n,2587)),Promise.resolve().then(n.bind(n,9532)),Promise.resolve().then(n.bind(n,4929)),Promise.resolve().then(n.bind(n,4297)),Promise.resolve().then(n.bind(n,5916)),Promise.resolve().then(n.bind(n,1201)),Promise.resolve().then(n.bind(n,9479)),Promise.resolve().then(n.bind(n,7876)),Promise.resolve().then(n.bind(n,4825)),Promise.resolve().then(n.bind(n,3071)),Promise.resolve().then(n.bind(n,8098)),Promise.resolve().then(n.bind(n,9971)),Promise.resolve().then(n.bind(n,8260)),Promise.resolve().then(n.bind(n,5455)),Promise.resolve().then(n.bind(n,4787)),Promise.resolve().then(n.bind(n,168)),Promise.resolve().then(n.bind(n,8084)),Promise.resolve().then(n.bind(n,9294)),Promise.resolve().then(n.bind(n,93)),Promise.resolve().then(n.bind(n,5955)),Promise.resolve().then(n.bind(n,7020)),Promise.resolve().then(n.bind(n,4284)),Promise.resolve().then(n.bind(n,2343)),Promise.resolve().then(n.bind(n,9931)),Promise.resolve().then(n.bind(n,1558)),Promise.resolve().then(n.bind(n,9376)),Promise.resolve().then(n.bind(n,5297)),Promise.resolve().then(n.bind(n,5730)),Promise.resolve().then(n.bind(n,8560)),Promise.resolve().then(n.bind(n,377)),Promise.resolve().then(n.bind(n,57)),Promise.resolve().then(n.bind(n,3851)),Promise.resolve().then(n.bind(n,5475)),Promise.resolve().then(n.bind(n,5635)),Promise.resolve().then(n.bind(n,7503)),Promise.resolve().then(n.bind(n,258)),Promise.resolve().then(n.bind(n,8209)),Promise.resolve().then(n.bind(n,6418)),Promise.resolve().then(n.bind(n,9573)),Promise.resolve().then(n.bind(n,7467)),Promise.resolve().then(n.bind(n,8898)),Promise.resolve().then(n.bind(n,3991)),Promise.resolve().then(n.bind(n,8043)),Promise.resolve().then(n.bind(n,8915)),Promise.resolve().then(n.bind(n,1033)),Promise.resolve().then(n.bind(n,8881)),Promise.resolve().then(n.bind(n,2523)),Promise.resolve().then(n.bind(n,3401)),Promise.resolve().then(n.bind(n,2765)),Promise.resolve().then(n.bind(n,8027)),Promise.resolve().then(n.bind(n,2303)),Promise.resolve().then(n.bind(n,3535)),Promise.resolve().then(n.bind(n,966)),Promise.resolve().then(n.bind(n,8073)),Promise.resolve().then(n.bind(n,4088)),Promise.resolve().then(n.bind(n,1001)),Promise.resolve().then(n.bind(n,8499)),Promise.resolve().then(n.bind(n,6615)),Promise.resolve().then(n.bind(n,2480)),Promise.resolve().then(n.bind(n,9277)),Promise.resolve().then(n.bind(n,4969))},5236:(e,t,n)=>{"use strict";n.d(t,{default:()=>T});var o=n(5155),i=n(2115);let r=e=>{let{online:t}=e;return(0,o.jsx)("div",{className:"online",children:t})};var s=n(8319),l=n(8422),a=n(3858),c=n(4282),d=n(9392),u=n(729);let h=e=>{let{tool:t,palette:n,color:r,range:h,onColorChange:m,onRangeChange:f,onView:v,onEyeDropper:p,onClear:g}=e,[b,x]=(0,i.useState)(!1);return(0,o.jsxs)("div",{children:[(0,o.jsxs)(s.aF,{className:"modal",dismissible:!0,show:b,size:"md",onClose:()=>x(!1),popup:!0,children:[(0,o.jsx)(s.aF.Header,{}),(0,o.jsx)(s.aF.Body,{children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)(l.f9d,{className:"mx-auto mb-4 h-14 w-14 text-white-400 dark:text-white-200"}),(0,o.jsx)("h3",{className:"mb-5 text-lg font-normal text-white-500 dark:text-white-400",children:"Are you sure you want to clear canvas?"}),(0,o.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,o.jsx)(s.$n,{color:"failure",onClick:()=>{x(!1),g()},children:"Yes, I'm sure"}),(0,o.jsx)(s.$n,{color:"gray",onClick:()=>x(!1),children:"No, cancel"})]})]})})]}),(0,o.jsxs)("div",{className:"controls",children:[(0,o.jsxs)("div",{className:"controls-row",children:[(0,o.jsx)("input",{type:"color",value:r,onChange:e=>{m(e.target.value)},className:"mb-4"}),(0,o.jsx)("input",{type:"range",value:h,onChange:e=>{f(parseInt(e.target.value))},min:"1",max:"50"}),(0,o.jsx)("button",{onClick:v,children:(0,o.jsx)(a.A,{className:"size-6"})}),(0,o.jsx)("button",{onClick:p,children:(0,o.jsx)(o.Fragment,{children:"pencil"===t?(0,o.jsx)(c.A,{className:"size-6"}):(0,o.jsx)(d.A,{className:"size-6"})})}),(0,o.jsx)("button",{onClick:()=>x(!0),children:(0,o.jsx)(u.A,{className:"size-6"})})]}),(0,o.jsx)(o.Fragment,{children:n.length>0&&(0,o.jsx)("div",{className:"controls-row color-palette",children:n.map((e,t)=>(0,o.jsx)("button",{style:{backgroundColor:e},onClick:()=>m(e)},"color-".concat(t)))})})]})]})};var m=n(5565),f=n(686),v=n(1886),p=n(7387),g=n(6046),b=n(5930),x=n(9230),j=n(3922),y=n(9903),w=n(9904);let S=0===(0,w.Dk)().length?(0,w.Wp)({apiKey:"AIzaSyA_pmw7yZXi6S772SSrzAHzWCRyKY-WslQ",authDomain:"relong-cloud.firebaseapp.com",projectId:"relong-cloud",storageBucket:"relong-cloud.appspot.com",messagingSenderId:"615504895391",appId:"1:615504895391:web:99cfe710a935df6104f1aa",measurementId:"G-VVVGLHG940"}):(0,w.Sx)(),P=async()=>await (0,y.TT)()?(0,y.dG)(S):null,N=async()=>{try{let e=await P();if(e)return await (0,y.gf)(e,{vapidKey:"BOGent2_mB7Kb_Q6kd_5HvuX9-no1-YovfgjlRr6wIlJ77wbugFktJ8mkUiFOyIhNZl420mHb9sycayQnD8lyPo"});return null}catch(e){return console.error("An error occurred while fetching the token:",e),null}};var k=n(814);async function C(){return"Notification"in window?"granted"===Notification.permission||"denied"!==Notification.permission&&"granted"===await Notification.requestPermission()?await N():(console.log("Notification permission not granted."),null):(console.info("This browser does not support desktop notification"),null)}let I=()=>{let e=(0,g.useRouter)(),[t,n]=(0,i.useState)(null),[o,r]=(0,i.useState)(null),s=(0,i.useRef)(0),l=(0,i.useRef)(!1),a=async()=>{if(l.current)return;l.current=!0;let e=await C();if("denied"===Notification.permission){n("denied"),console.info("%cPush Notifications issue - permission denied","color: green; background: #c7c7c7; padding: 8px; font-size: 20px"),l.current=!1;return}if(!e){if(s.current>=3){alert("Unable to load token, refresh the browser"),console.info("%cPush Notifications issue - unable to load token after 3 retries","color: green; background: #c7c7c7; padding: 8px; font-size: 20px"),l.current=!1;return}s.current+=1,console.error("An error occurred while retrieving token. Retrying..."),l.current=!1,await a();return}n(Notification.permission),r(e),l.current=!1};return(0,i.useEffect)(()=>{"Notification"in window&&a()},[]),(0,i.useEffect)(()=>{let t=null;return(async()=>{if(!o)return;let t=await P();if(t)return(0,y.xD)(t,t=>{var n,o,i,r,s,l,a,c;if("granted"!==Notification.permission)return;let d=(null===(n=t.fcmOptions)||void 0===n?void 0:n.link)||(null===(o=t.data)||void 0===o?void 0:o.link);d?k.oR.info("".concat(null===(s=t.notification)||void 0===s?void 0:s.title,": ").concat(null===(l=t.notification)||void 0===l?void 0:l.body),{position:"bottom-center",action:{label:"Visit",onClick:()=>{var n,o;let i=(null===(n=t.fcmOptions)||void 0===n?void 0:n.link)||(null===(o=t.data)||void 0===o?void 0:o.link);i&&e.push(i)}}}):k.oR.info("".concat(null===(a=t.notification)||void 0===a?void 0:a.title,": ").concat(null===(c=t.notification)||void 0===c?void 0:c.body),{position:"bottom-center"}),new Notification((null===(i=t.notification)||void 0===i?void 0:i.title)||"New message",{body:(null===(r=t.notification)||void 0===r?void 0:r.body)||"This is a new message",data:d?{url:d}:void 0}).onclick=t=>{var n,o;t.preventDefault();let i=null===(o=t.target)||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.url;i&&e.push(i)}})})().then(e=>{e&&(t=e)}),()=>null==t?void 0:t()},[o,e,k.oR]),{token:o,notificationPermissionStatus:t}},R=e=>{let{topic:t}=e,{token:n,notificationPermissionStatus:r}=I(),[l,a]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=localStorage.getItem("notifications");h(e?e.split(","):[])},[]);let m=async()=>{a(!0);let e=await fetch("/send-notification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:t,token:n,title:"The Bell rang!",message:"Hurry up and check what happened.",link:"https://relong.cloud/?token=".concat(t),subscribed:u.includes(t)})});await e.json().then(()=>{u.push(t),h(u),localStorage.setItem("notifications",u.join(",")),a(!1)}).catch(()=>{k.oR.error("Error? Try again...",{icon:(0,o.jsx)(b.A,{}),position:"bottom-center"}),a(!1)})},f=async()=>{d(!0);let e=await fetch("/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:t,token:n})});await e.json().then(()=>{u.splice(u.indexOf(t),1),h(u),localStorage.setItem("notifications",u.join(",")),d(!1)}).catch(()=>{k.oR.error("Error? Try again...",{icon:(0,o.jsx)(b.A,{}),position:"bottom-center"}),d(!1)})};return(0,o.jsx)(o.Fragment,{children:"granted"===r&&(0,o.jsxs)("div",{children:[(0,o.jsx)(o.Fragment,{children:u.includes(t)&&(0,o.jsx)("button",{className:"unsubscribe",disabled:c,onClick:f,children:(0,o.jsx)(o.Fragment,{children:c?(0,o.jsx)("div",{className:"absolute flex justify-center items-center w-dvw h-dvh",children:(0,o.jsx)(s.y$,{"aria-label":"Loading...",size:"md"})}):(0,o.jsx)(x.A,{className:"size-4"})})})}),(0,o.jsx)("button",{className:"bell",disabled:l,onClick:m,children:(0,o.jsx)(o.Fragment,{children:l?(0,o.jsx)("div",{className:"absolute flex justify-center items-center w-dvw h-dvh",children:(0,o.jsx)(s.y$,{"aria-label":"Loading...",size:"xl"})}):(0,o.jsx)(j.A,{className:"size-6"})})})]})})},T=()=>{let e=(0,i.useRef)(null),t=(0,i.useRef)(null),n=(0,i.useRef)(0),l=(0,i.useRef)(null),[a,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(!0),[b,x]=(0,i.useState)("pencil"),[j,y]=(0,i.useState)([]),[w,S]=(0,i.useState)(!1),[P,N]=(0,i.useState)(!1),[C,I]=(0,i.useState)(0),[T,F]=(0,i.useState)(0),[z,M]=(0,i.useState)(0),[A,E]=(0,i.useState)(0),[O,L]=(0,i.useState)(null),[Y,D]=(0,i.useState)("#ffffff"),[X,_]=(0,i.useState)(10),[J,W]=(0,i.useState)(!1),[B,H]=(0,i.useState)(!1),[U,$]=(0,i.useState)(70),[G]=(0,i.useState)(3e3),[V]=(0,i.useState)(3e3),K=(0,i.useRef)(25),[Q]=(0,i.useState)(150),[Z]=(0,i.useState)(25),[q,ee]=(0,i.useState)(25),[et,en]=(0,i.useState)(0),[eo,ei]=(0,i.useState)(0),[er,es]=(0,i.useState)(!1),[el,ea]=(0,i.useState)(null),[ec,ed]=(0,i.useState)(!1),[eu,eh]=(0,i.useState)(""),[em,ef]=(0,i.useState)("default"),ev=(0,g.useSearchParams)();(0,i.useEffect)(()=>{let e=ev.get("token")||"default";ef(e.replace(/[^a-zA-Z0-9]/g,"")),D(localStorage.getItem("color")||"#"+Math.floor(0xffffff*Math.random()).toString(16).padStart(6,"0"));let t=localStorage.getItem("range");_(t?parseInt(t):10);let o=new window.Image;return o.onerror=o.onabort=function(){W(!1)},o.onload=function(){W(!0)},o.src="/references/".concat(e,".jpg"),()=>{l.current&&(clearTimeout(l.current),l.current=null,n.current=0),el&&el.close()}},[]),(0,i.useEffect)(()=>{let e=t.current;if(e){let t=e.getContext("2d");t&&(t.lineWidth=X,t.lineCap="round",t.strokeStyle=Y,a||(t.rect(0,0,G,V),t.fill()),L(t),a&&(localStorage.setItem("color",Y),localStorage.setItem("range",String(X))))}},[a,Y,X]),(0,i.useEffect)(()=>{O&&!el&&ep()},[O]);let ep=()=>{{let e=new WebSocket("ws://0.0.0.0:8080",em);e.onopen=()=>{l.current&&(clearTimeout(l.current),l.current=null),n.current=0},e.onclose=()=>{c(!1),u(!0),eg()},e.onmessage=e=>{let t=JSON.parse(e.data);if("initState"===t.type){eM(t.data),ei(t.online),y(t.palette||[]),u(!1),c(!0);let e=localStorage.getItem("private-room");!e&&t.privateRoom&&(localStorage.setItem("private-room",t.privateRoom),e=t.privateRoom),e&&"default"===em&&k.oR.info("Want to start drawing in a private room?",{icon:(0,o.jsx)(f.A,{}),duration:2e4,position:"bottom-center",action:{label:"Yes",onClick:()=>{window.location.href="/?token=".concat(e)}}})}"loadState"===t.type&&(eM(t.data),ei(t.online),u(!1)),"draw"===t.type&&eN(t.x,t.y,t.color,t.range),"save"===t.type&&ez(),"setOnline"===t.type&&ei(t.online)},ea(e),es(!0)}},eg=()=>{n.current+=1;let e=Math.min(1e3*n.current,1e4);console.log("Attempting to reconnect (#".concat(n.current,") in ").concat(e/1e3," seconds...")),l.current=setTimeout(()=>{ep()},e)},eb=e=>{e.preventDefault()},ex=t=>{if("touches"in t&&2===t.touches.length||"button"in t&&2===t.button){S(!1),N(!0);let n=e.current;if(n){let e="touches"in t?eR(t):{x:t.pageX,y:t.pageY};I(e.x-n.offsetLeft),M(n.scrollLeft),F(e.y-n.offsetTop),E(n.scrollTop)}}"touches"in t&&2===t.touches.length&&en(eF(t))},ej=t=>{if(!P)return;let n=e.current;if(n){let e="touches"in t?eR(t):{x:t.pageX,y:t.pageY};n.scrollLeft=z-(e.x-n.offsetLeft-C)*3,n.scrollTop=A-(e.y-n.offsetTop-T)*3}if("touches"in t){let e=eF(t);Math.abs(et-e)>5&&(e>et?eT("up",2):eT("down",2)),en(e)}},ey=()=>{N(!1)},ew=e=>{switch(b){case"pencil":("touches"in e&&1===e.touches.length||"button"in e&&0===e.button)&&S(!0);break;case"eye-dropper":if(O){let t=eC(e),n=O.getImageData(t.x,t.y,1,1).data;D("#"+("000000"+eS(n[0],n[1],n[2])).slice(-6)),x("pencil")}}},eS=(e,t,n)=>{if(e>255||t>255||n>255)throw"Invalid color component";return(e<<16|t<<8|n).toString(16)},eP=e=>{if(!w||!O||er&&!el)return;let t=eC(e);el&&el.send(JSON.stringify({type:"draw",x:t.x,y:t.y,color:Y,range:X})),eN(t.x,t.y,Y,X)},eN=(e,t,n,o)=>{O&&(O.beginPath(),O.arc(e,t,o,0,2*Math.PI,!1),O.fillStyle=n,O.fill())},ek=e=>{w&&O&&(!er||el)&&(("clientX"in e||"clientY"in e)&&eP(e),el&&el.send(JSON.stringify({type:"save"})),S(!1),ez())},eC=e=>"touches"in e?eI(e):{x:e.nativeEvent.offsetX/(K.current/100),y:e.nativeEvent.offsetY/(K.current/100)},eI=e=>{var n;let o=e.touches[0],i=null===(n=t.current)||void 0===n?void 0:n.getBoundingClientRect();return{x:(o.clientX-((null==i?void 0:i.left)||0))/(K.current/100),y:(o.clientY-((null==i?void 0:i.top)||0))/(K.current/100)}},eR=t=>{var n;let o=t.touches[0],i=null===(n=e.current)||void 0===n?void 0:n.getBoundingClientRect();return{x:o.pageX-((null==i?void 0:i.left)||0),y:o.pageY-((null==i?void 0:i.top)||0)}},eT=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;"up"===e&&K.current<Q&&(K.current+=t),"down"===e&&K.current>Z&&(K.current-=t),K.current<Z&&(K.current=Z),K.current>Q&&(K.current=Q),ee(K.current)},eF=e=>e.touches&&2===e.touches.length?Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY):0,ez=()=>{if(O){let e=t.current;if(e){let t=e.toDataURL();er&&el?el.send(JSON.stringify({type:"saveState",data:t})):localStorage.setItem("state",t)}}},eM=e=>{if(O){let t=new window.Image;null!=e&&""!=e?t.src=e:(O.reset(),O.rect(0,0,G,V),O.fill()),t.onload=function(){O.reset(),O.drawImage(t,0,0)}}};return(0,o.jsxs)("div",{className:"main-container",children:[(0,o.jsxs)(s.aF,{className:"modal",dismissible:!0,show:ec,size:"7xl",onClose:()=>ed(!1),popup:!0,children:[(0,o.jsx)(s.aF.Header,{}),(0,o.jsx)(s.aF.Body,{children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"flex justify-center ",children:(0,o.jsxs)("div",{className:"mb-5 relative",style:{width:"70dvh"},children:[(0,o.jsx)(m.default,{className:"preview",src:eu,width:G,height:V,style:{width:"100%",height:"100%"},alt:"Preview"}),(0,o.jsx)(o.Fragment,{children:J&&(0,o.jsx)(m.default,{className:"reference",onError:()=>{W(!1)},src:"/references/".concat(em,".jpg"),width:G,height:V,style:{width:"100%",height:"100%",opacity:U/100},alt:"Reference",onWheel:e=>{let t=e.deltaY>0?U-5:U+5;t>100&&(t=100),t<0&&(t=0),$(t)}})})]})}),(0,o.jsx)(o.Fragment,{children:J&&(0,o.jsx)("input",{className:"mb-5",type:"range",value:U,onChange:e=>{$(parseInt(e.target.value))},min:"0",max:"100"})}),(0,o.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,o.jsx)(s.$n,{color:"gray",onClick:()=>{let e=t.current;if(e){let t=document.createElement("a");t.href=e.toDataURL(),t.download="canvas.png",t.click()}},children:(0,o.jsx)(v.A,{className:"size-6"})}),(0,o.jsx)(s.$n,{color:"gray",onClick:()=>ed(!1),children:"Close"})]})]})})]}),(0,o.jsx)(o.Fragment,{children:a&&(0,o.jsxs)("div",{children:[(0,o.jsx)(h,{tool:b,palette:j,color:Y,range:X,onColorChange:e=>{D(e)},onRangeChange:e=>{_(e)},onView:()=>{let e=t.current;e&&(ed(!0),eh(e.toDataURL()))},onEyeDropper:()=>{x("pencil"===b?"eye-dropper":"pencil")},onClear:()=>{er&&el?(u(!0),el.send(JSON.stringify({type:"clearState"}))):(localStorage.removeItem("state"),O&&(O.reset(),O.rect(0,0,G,V),O.fill()))}}),(0,o.jsx)(o.Fragment,{children:J&&(0,o.jsx)("div",{className:"reference-small",onClick:()=>{H(!B)},children:(0,o.jsx)(o.Fragment,{children:B?(0,o.jsx)(m.default,{onError:()=>{W(!1)},src:"/references/".concat(em,".jpg"),width:300,height:300,alt:"Reference"}):(0,o.jsx)(p.A,{className:"size-6"})})})}),(0,o.jsx)(o.Fragment,{children:er&&(0,o.jsxs)("div",{children:[(0,o.jsx)(r,{online:eo}),(0,o.jsx)(R,{topic:em})]})})]})}),(0,o.jsx)(o.Fragment,{children:d&&(0,o.jsx)("div",{className:"absolute flex justify-center items-center w-dvw h-dvh",children:(0,o.jsx)(s.y$,{"aria-label":"Loading...",size:"xl"})})}),(0,o.jsx)("div",{ref:e,onMouseDown:ex,onMouseMove:ej,onMouseUp:ey,onMouseLeave:ey,onTouchStart:ex,onTouchMove:ej,onTouchEnd:ey,onWheel:t=>{if(eT(t.deltaY>0?"down":"up",5),K.current!==Q&&K.current!==Z){let n=e.current;if(n){let e=K.current/100,o=(t.clientX-n.offsetLeft+n.scrollLeft)/e,i=(t.clientY-n.offsetTop+n.scrollTop)/e,r=o*e-n.clientWidth/2,s=i*e-n.clientHeight/2;n.scrollTo({left:r,top:s})}}},className:"canvas-container",onContextMenu:eb,children:(0,o.jsx)("canvas",{ref:t,onMouseDown:ew,onMouseMove:eP,onMouseUp:ek,onMouseLeave:ek,onTouchStart:ew,onTouchMove:eP,onTouchEnd:ek,width:G,height:V,onContextMenu:eb,style:{width:G,height:V,backgroundColor:"#000000",zoom:"".concat(q,"%")}})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[479,777,446,711,545,814,426,441,517,358],()=>t(8755)),_N_E=e.O()}]);